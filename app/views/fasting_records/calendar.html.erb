<%# app/views/fasting_records/calendar.html.erb %>
<% content_for :title, "断食カレンダー" %>

<div class="mx-auto max-w-5xl p-4 pb-28 md:pb-32">
  <div class="rounded-3xl bg-white/80 backdrop-blur-xl ring-1 ring-stone-300/60 shadow-xl p-4 sm:p-5">
    <div class="flex items-center justify-between gap-2 flex-wrap">
      <h1 class="text-lg sm:text-xl md:text-2xl font-semibold text-stone-900">
        断食カレンダー
        <span class="text-stone-600 text-sm sm:text-base">(<%= @year %>年 <%= @month %>月)</span>
      </h1>
      <div class="flex items-center gap-2 flex-wrap text-xs sm:text-sm">
        <%= link_to "前月",
                    calendar_fasting_records_path(year: @prev_year, month: @prev_month),
                    class: "px-3 py-1.5 rounded-xl ring-1 ring-stone-300 bg-white/70 hover:bg-white/90" %>
        <%= link_to "今月",
                    calendar_fasting_records_path(year: @today.year, month: @today.month),
                    class: "px-3 py-1.5 rounded-xl ring-1 ring-sky-200 bg-white/70 hover:bg-white/90" %>
        <%= link_to "翌月",
                    calendar_fasting_records_path(year: @next_year, month: @next_month),
                    class: "px-3 py-1.5 rounded-xl ring-1 ring-stone-300 bg-white/70 hover:bg-white/90" %>
      </div>
    </div>

    <div class="mt-4 grid grid-cols-7 gap-2 text-[10px] sm:text-[12px] md:text-sm">
      <% %w[月 火 水 木 金 土 日].each do |w| %>
        <div class="px-2 py-1 text-center font-medium text-stone-700"><%= w %></div>
      <% end %>
    </div>

    <div class="mt-1 grid grid-cols-7 gap-2">
      <% day = @calendar_start %>
      <% while day <= @calendar_end %>
        <% record = @records_by_date[day] %>
        <%= link_to fasting_records_path(date: day),
                    class: day_cell_classes(day, @month),
                    "aria-label": "#{day.strftime('%Y/%m/%d')} の記録一覧へ" do %>

          <%# 日付部分：モバイル=色付き丸チップ / デスクトップ=従来表示 %>
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-1">
              <%= mobile_colored_day_number(day, record, today: (day == @today)) %>
              <%= desktop_day_number(day, today: (day == @today)) %>
            </div>

            <%# 「本日」ラベルはsm以上のみ %>
            <% if day == @today %>
              <span class="hidden sm:inline text-[10px] px-2 py-0.5 rounded bg-sky-100 text-sky-700 ring-1 ring-sky-200">
                <%= t("calendar.today", default: "本日") %>
              </span>
            <% end %>
          </div>

          <%# 状態テキストや結果はモバイルでは非表示、PCのみバッジ表示。結果時刻は常に出さない %>
          <div class="mt-1 hidden sm:block">
            <% if record %>
              <%= fasting_badge_for(record) %>
            <% else %>
              <div class="text-[11px] text-stone-500">記録なし</div>
            <% end %>
          </div>
        <% end %>
        <% day += 1.day %>
      <% end %>
    </div>

    <div class="mt-6 flex flex-wrap items-center gap-3 text-[12px] text-stone-800">
      <span class="inline-flex items-center gap-1">
        <span class="inline-block w-5"><%= tailwind_badge("◯", "bg-green-100 text-green-700 ring-green-200") %></span> 成功
      </span>
      <span class="inline-flex items-center gap-1">
        <span class="inline-block w-5"><%= tailwind_badge("△", "bg-amber-100 text-amber-700 ring-amber-200") %></span> 途中
      </span>
      <span class="inline-flex items-center gap-1">
        <span class="inline-block w-5"><%= tailwind_badge("×", "bg-rose-100 text-rose-700 ring-rose-200") %></span> 未達
      </span>
    </div>
  </div>
</div>
