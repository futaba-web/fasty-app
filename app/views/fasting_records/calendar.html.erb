<%# app/views/fasting_records/calendar.html.erb %>
<% content_for :title, "断食カレンダー" %>

<div class="mx-auto max-w-5xl p-4 pb-28 md:pb-32">
  <div class="rounded-3xl bg-white/80 backdrop-blur-xl ring-1 ring-stone-300/60 shadow-xl p-4 sm:p-5">
    <!-- 見出し & 月移動 -->
    <div class="flex items-center justify-between gap-2 flex-wrap">
      <h1 class="text-lg sm:text-xl md:text-2xl font-semibold text-stone-900">
        断食カレンダー
        <span class="text-stone-600 text-sm sm:text-base">(<%= @year %>年 <%= @month %>月)</span>
      </h1>
      <div class="flex items-center gap-2 flex-wrap text-xs sm:text-sm">
        <%= link_to "前月",
                    calendar_fasting_records_path(year: @prev_year, month: @prev_month),
                    class: "px-3 py-1.5 rounded-xl ring-1 ring-stone-300 bg-white/70 hover:bg-white/90" %>
        <%= link_to "今月",
                    calendar_fasting_records_path(year: @today.year, month: @today.month),
                    class: "px-3 py-1.5 rounded-xl ring-1 ring-sky-200 bg-white/70 hover:bg-white/90" %>
        <%= link_to "翌月",
                    calendar_fasting_records_path(year: @next_year, month: @next_month),
                    class: "px-3 py-1.5 rounded-xl ring-1 ring-stone-300 bg-white/70 hover:bg-white/90" %>
      </div>
    </div>

    <!-- 曜日 -->
    <div class="mt-4 grid grid-cols-7 gap-2 text-[10px] sm:text-[12px] md:text-sm">
      <% %w[月 火 水 木 金 土 日].each do |w| %>
        <div class="px-2 py-1 text-center font-medium text-stone-700"><%= w %></div>
      <% end %>
    </div>

    <!-- カレンダー本体 -->
    <div class="mt-1 grid grid-cols-7 gap-2">
      <% day = @calendar_start %>
      <% while day <= @calendar_end %>
        <% record = @records_by_date[day] %>

        <%= link_to fasting_records_path(date: day),
                    class: day_cell_outer_classes(day),
                    "aria-label": "#{day.strftime('%Y/%m/%d')} の記録一覧へ" do %>

          <div class="<%= day_cell_classes(day, @month) %>">
            <!-- 上段：日付（モバイルは色チップで状態表示） / 本日バッジ(PCのみ) -->
            <div class="flex items-start justify-between">
              <span class="<%= day_number_chip_classes(record, day, @today) %>"><%= day.day %></span>
              <% if day == @today %>
                <span class="hidden sm:inline-flex text-[10px] px-2 py-0.5 rounded bg-sky-100 text-sky-700 ring-1 ring-sky-200">
                  <%= t("calendar.today") %>
                </span>
              <% end %>
            </div>

            <!-- 下段：PCのみバッジ表示 / モバイルは非表示（情報量削減） -->
            <% if record %>
              <div class="mt-1 hidden sm:block"><%= fasting_badge_for(record) %></div>
            <% else %>
              <div class="mt-2 text-[11px] text-stone-500 hidden sm:block">記録なし</div>
            <% end %>
          </div>

        <% end %>
        <% day += 1.day %>
      <% end %>
    </div>

    <!-- 凡例（PC向け表示想定） -->
    <div class="mt-6 flex flex-wrap items-center gap-3 text-[12px] text-stone-800">
      <span class="inline-flex items-center gap-1">
        <span class="inline-block w-5"><%= tailwind_badge("◯", "bg-green-100 text-green-700 ring-green-200") %></span> 成功
      </span>
      <span class="inline-flex items-center gap-1">
        <span class="inline-block w-5"><%= tailwind_badge("△", "bg-amber-100 text-amber-700 ring-amber-200") %></span> 途中
      </span>
      <span class="inline-flex items-center gap-1">
        <span class="inline-block w-5"><%= tailwind_badge("×", "bg-rose-100 text-rose-700 ring-rose-200") %></span> 未達
      </span>
    </div>
  </div>
</div>
