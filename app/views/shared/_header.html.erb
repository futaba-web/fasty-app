<!-- app/views/layouts/_header.html.erb ãªã© -->

<header class="sticky top-[env(safe-area-inset-top)] z-50 h-16 bg-brand-header text-white shadow-sm">
  <div class="mx-auto max-w-[1200px] h-16 px-4 md:px-8 flex items-center gap-3">

    <!-- å·¦ï¼šãƒ­ã‚´ -->
    <%= link_to (user_signed_in? ? authenticated_root_path : unauthenticated_root_path),
                class: "flex items-center gap-2 shrink-0",
                aria: { label: "Fasty ãƒ›ãƒ¼ãƒ " } do %>
      <span class="text-2xl md:text-3xl font-semibold tracking-wide select-none">Fasty</span>
    <% end %>

    <% if user_signed_in? %>
      <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒˆã‚°ãƒ«ï¼ˆãƒ¢ãƒã‚¤ãƒ«/PCå…±é€šã§è¡¨ç¤ºï¼‰ -->
      <button
        type="button"
        class="ml-2 inline-flex items-center justify-center size-10 rounded-xl ring-1 ring-white/20
               hover:ring-white/40 focus:outline-none focus:ring-2 focus:ring-white/60"
        data-menu-target="button" data-action="click->menu#toggle"
        aria-controls="site-drawer" aria-expanded="false" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             class="w-5 h-5" aria-hidden="true" focusable="false" fill="none">
          <path d="M3 6h18M3 12h18M3 18h18"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
      </button>
    <% end %>

    <!-- å³å´ -->
    <nav class="ml-auto flex items-center gap-6">
      <% unless user_signed_in? %>
        <%= nav_link_to "ãƒ­ã‚°ã‚¤ãƒ³", new_user_session_path %>
      <% end %>

      <% if user_signed_in? %>
        <!-- åˆå›æ¡ˆå†…ï¼šmdä»¥ä¸Šã§è¡¨ç¤ºã€é–‰ã˜ãŸã‚‰localStorageã§éè¡¨ç¤ºï¼ˆæ’ä¹…ï¼‰ -->
        <div id="guide-pill"
             class="hidden md:flex items-center gap-2 rounded-full bg-white/12 ring-1 ring-white/25 px-3 py-1.5
                    shadow-sm backdrop-blur-sm"
             role="region" aria-label="ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹ãƒªãƒ³ã‚¯">
          <%= link_to guide_path,
                class: "inline-flex items-center gap-2 font-semibold tracking-wide whitespace-nowrap
                        hover:underline underline-offset-4",
                aria: { label: "ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹ã‚’é–‹ã" } do %>
            <span class="i i-book" aria-hidden="true">ğŸ“˜</span>
            <span>ã‚¢ãƒ—ãƒªã®ä½¿ã„æ–¹</span>
          <% end %>
          <button type="button"
                  class="ml-1 inline-flex items-center justify-center size-7 rounded-full hover:bg-white/10
                         focus:outline-none focus:ring-2 focus:ring-white/60"
                  aria-label="ãƒ˜ãƒ«ãƒ—ã®æ¡ˆå†…ã‚’é–‰ã˜ã‚‹" data-close>
            âœ•
          </button>
        </div>
      <% end %>
    </nav>

  </div>

  <%# --- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆStimulusä¸è¦ / v1ã‚­ãƒ¼ã§å°†æ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†å¯ï¼‰ --- %>
  <% if user_signed_in? %>
    <script>
      (function () {
        try {
          var KEY = "fasty.guidePill.dismissed.v1";
          if (localStorage.getItem(KEY) === "1") return;
          var pill = document.getElementById("guide-pill");
          if (!pill) return;
          pill.classList.remove("hidden");            // è¡¨ç¤º
          var btn = pill.querySelector("[data-close]");
          if (btn) btn.addEventListener("click", function (e) {
            e.preventDefault();
            pill.remove();
            localStorage.setItem(KEY, "1");           // æ¬¡å›ä»¥é™ã¯å‡ºã•ãªã„
          });
        } catch (_) { /* å¤±æ•—ã—ã¦ã‚‚è‡´å‘½çš„ã§ã¯ãªã„ã®ã§é»™æ®º */ }
      })();
    </script>
  <% end %>
</header>
