<!DOCTYPE html>
<html lang="ja">
  <head>
    <title><%= content_for?(:title) ? yield(:title) : "Fasty" %></title>

    <!-- 基本: モバイル最適化 -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#16a34a"><!-- manifest と合わせる -->

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <!-- PWA / Icons -->
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="icon" href="/icon.svg" type="image/svg+xml"><!-- SVG優先 -->
    <link rel="icon" href="/icon.png" type="image/png"><!-- フォールバック -->
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">

    <!-- importmap（Turbo/Stimulus 起動） -->
    <%= javascript_importmap_tags %>
    <%= javascript_import_module_tag "application", "data-turbo-track": "reload" %>

    <!-- CSS: まずBootstrap（Devise画面のみ）、後からTailwind/app -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      data-turbo-track="reload"
    />
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <!-- 画面個別で <head> を追記したい場合 -->
    <%= yield :head %>
  </head>

  <body class="text-gray-900">
    <%= render "shared/header" %>

    <div class="auth-bg bg-fixed auto-top-35"
         style="background-image: url('<%= asset_path("landing/hero.jpg") %>')">
      <div class="auth-dim"></div>

      <main class="auth-center">
        <div class="auth-card">
          <%= render "shared/flash" %>
          <%= yield %>
        </div>
      </main>
    </div>

    <%= render "shared/footer" %>

    <!-- Service Worker 登録（本体と同じにしておく） -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function () {
          navigator.serviceWorker.register('/service-worker.js');
        });
      }
    </script>
  </body>
</html>
