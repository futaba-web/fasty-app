<%# app/views/mypages/show.html.erb %>

<div class="mypage-bg">
  <!-- ä¸Šä½™ç™½ã¯ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ï¼ˆpt-0ï¼‰ã€‚ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã‚‚å°‘ã—ã ã‘è©°ã‚ã‚‹ -->
  <div class="relative max-w-3xl mx-auto px-6 pt-0 pb-0 space-y-4 sm:space-y-5">

    <!-- â–¼ æŒ¨æ‹¶ãƒãƒ¼ï¼šãƒ˜ãƒƒãƒ€ãƒ¼ç›´ä¸‹ã‹ã‚‰å°‘ã—ã ã‘é–“ã‚’ç©ºã‘ã‚‹ï¼ˆmt-5ï¼‰ -->
    <div class="mt-5 sm:mt-6">
      <%= render "shared/greeting", user: current_user %>
    </div>

    <% title_text, kind = fasting_hero(current_user) %>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šãƒ˜ãƒƒãƒ€ãƒ¼åŒè‰²ï¼‹ç™½æ–‡å­—ï¼çŠ¶æ…‹ã¯ãƒ‰ãƒƒãƒˆ -->
    <div class="flex justify-center">
      <div class="<%= hero_class_for(kind, theme: :neutral) %>"
           role="region" aria-label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
        <span class="sr-only">çŠ¶æ…‹</span>
        <span class="w-2.5 h-2.5 rounded-full <%= status_dot_color(kind) %>"></span>
        <h1 class="text-base sm:text-lg font-extrabold tracking-wide leading-snug">
          <%= title_text %>
        </h1>
      </div>
    </div>

    <div class="text-gray-700">
      æœ¬æ—¥ï¼š<strong><%= l Time.zone.today, format: :long %></strong>
    </div>

    <% if @running&.target_hours.present? %>
      <div class="text-gray-700">
        ç›®æ¨™æ™‚é–“ï¼š<strong><%= @running.target_hours %>æ™‚é–“</strong>
      </div>
    <% end %>

    <% if @running.present? %>
      <!-- é€²è¡Œä¸­ã‚«ãƒ¼ãƒ‰ -->
      <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
        <div class="flex items-center gap-3 text-lg sm:text-xl">
          <span class="text-2xl sm:text-3xl">ðŸ•’</span>
          <span
            data-controller="timer"
            data-timer-start-at-value="<%= @running.start_time.to_i %>"
            class="font-mono text-2xl sm:text-3xl align-middle">00:00:00</span>
        </div>
        <div class="text-sm text-gray-600">é–‹å§‹ï¼š<%= l @running.start_time %></div>
        <div class="text-right">
          <%= link_to "çž‘æƒ³ã§å¿ƒã‚’æ•´ãˆã‚‹",
                      meditations_path,
                      class: "text-sky-600 underline text-sm font-semibold" %>
        </div>
      </div>

      <!-- çµ‚äº†ãƒœã‚¿ãƒ³ï¼šãƒ†ã‚­ã‚¹ãƒˆå¹…ã«ãƒ•ã‚£ãƒƒãƒˆ -->
      <div class="mt-6 sm:mt-8 mb-0 flex justify-center">
        <%= button_to "ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°çµ‚äº†",
              finish_fasting_record_path(@running),
              method: :post,
              form:  { class: "mx-auto" },
              class: "btn btn-danger btn-lg btn-wrap" %>
      </div>

    <% else %>
      <%= form_with url: start_fasting_records_path, method: :post, local: true,
                    html: { id: "start-form" }, class: "space-y-5 sm:space-y-6" do %>
        <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
          <label class="block text-sm text-gray-600">ç›®æ¨™æ™‚é–“</label>
          <%= select_tag :target_hours,
                options_for_select(FastingRecord::TARGET_HOURS_CHOICES.map { |h| ["#{h}æ™‚é–“", h] }),
                include_blank: "é¸æŠžã—ã¦ãã ã•ã„ðŸ”½",
                required: true,
                class: "border rounded px-3 py-2 w-full max-w-xs" %>
        </div>

        <!-- é–‹å§‹ãƒœã‚¿ãƒ³ï¼šãƒ†ã‚­ã‚¹ãƒˆå¹…ã«ãƒ•ã‚£ãƒƒãƒˆ -->
        <div class="pt-1 mb-1 sm:mb-0 flex justify-center">
          <%= submit_tag "ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°é–‹å§‹",
                class: "btn-mint btn-lg btn-wrap" %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
