<%# app/views/mypages/show.html.erb %>

<div class="mypage-bg">
  <!-- ä¸Šã¯åºƒã‚ / ä¸‹ã¯æœ€å°é™ï¼ˆpb-2ï¼‰ / ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–“ã¯å°‘ã—ã‚†ã£ãŸã‚Š -->
  <div class="max-w-3xl mx-auto px-6 pt-6 sm:pt-8 pb-0 space-y-5 sm:space-y-6">
    <% title_text, kind = fasting_hero(current_user) %>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼šè¦–èªæ€§ã¯ä¿ã¡ã¤ã¤é«˜ã•æŽ§ãˆã‚ -->
    <div class="<%= hero_class_for(kind) %> !py-3 sm:!py-4" role="region" aria-label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
      <h1 class="text-xl sm:text-2xl font-extrabold tracking-wide leading-tight"><%= title_text %></h1>
    </div>

    <div class="text-gray-700">
      æœ¬æ—¥ï¼š<strong><%= l Time.zone.today, format: :long %></strong>
    </div>

    <% if @running.present? && @running.target_hours.present? %>
      <div class="text-gray-700">
        ç›®æ¨™æ™‚é–“ï¼š<strong><%= @running.target_hours %>æ™‚é–“</strong>
      </div>
    <% end %>

    <% if @running.present? %>
      <!-- é€²è¡Œä¸­ã‚«ãƒ¼ãƒ‰ï¼šã‚†ã¨ã‚Šã‚’å°‘ã—å¢—ã‚„ã™ -->
      <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
        <div class="flex items-center gap-3 text-lg sm:text-xl">
          <span class="text-2xl sm:text-3xl">ðŸ•’</span>
          <span
            data-controller="timer"
            data-timer-start-at-value="<%= @running.start_time.to_i %>"
            class="font-mono text-2xl sm:text-3xl align-middle">00:00:00</span>
        </div>
        <div class="text-sm text-gray-600">é–‹å§‹ï¼š<%= l @running.start_time %></div>
        <div class="text-right">
          <%= link_to "è¨˜éŒ²ä¸€è¦§ã¸", fasting_records_path, class: "text-blue-600 underline text-sm" %>
        </div>
      </div>

      <!-- CTAï¼šä¸Šã¯å°‘ã—ç©ºã‘ã‚‹ / ä¸‹ã¯ãƒ•ãƒƒã‚¿ãƒ¼ã«å¯„ã›ã‚‹ï¼ˆmb-1 sm:mb-0ï¼‰ -->
      <div class="mt-6 sm:mt-8 mb-0 sm:mb-0 flex justify-center">
        <%= button_to "ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°çµ‚äº†",
              finish_fasting_record_path(@running),
              method: :post,
              form:  { class: "mx-auto w-5/6 sm:w-2/3 md:w-1/2 max-w-md" },
              class: "btn btn-danger w-full whitespace-nowrap
                      py-5 sm:py-6 md:py-7
                      px-6 sm:px-8 md:px-10
                      text-lg sm:text-xl md:text-2xl
                      rounded-xl shadow-lg" %>
      </div>

    <% else %>
      <%= form_with url: start_fasting_records_path, method: :post, local: true,
                    html: { id: "start-form" }, class: "space-y-5 sm:space-y-6" do %>
        <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
          <label class="block text-sm text-gray-600">ç›®æ¨™æ™‚é–“</label>
          <%= select_tag :target_hours,
                options_for_select(FastingRecord::TARGET_HOURS_CHOICES.map { |h| ["#{h}æ™‚é–“", h] }),
                include_blank: "é¸æŠžã—ã¦ãã ã•ã„ðŸ”½",
                required: true,
                class: "border rounded px-3 py-2 w-full max-w-xs" %>
        </div>

        <!-- é–‹å§‹ãƒœã‚¿ãƒ³ã‚‚åŒæ§˜ã«ä¸‹ã‚’è©°ã‚ã‚‹ -->
        <div class="pt-1 mb-1 sm:mb-0 flex justify-center">
          <%= submit_tag "ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°é–‹å§‹",
                class: "btn btn-primary w-5/6 sm:w-2/3 md:w-1/2 max-w-md whitespace-nowrap
                        py-5 sm:py-6 md:py-7
                        px-6 sm:px-8 md:px-10
                        text-lg sm:text-xl md:text-2xl
                        rounded-xl shadow-lg" %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
