<%# app/views/mypages/show.html.erb %>

<div class="mypage-bg">
  <!-- 上余白はコンパクトに（pt-0）。セクション間も少しだけ詰める -->
  <div class="relative max-w-3xl mx-auto px-6 pt-0 pb-0 space-y-4 sm:space-y-5">

    <!-- ▼ 挨拶バー：ヘッダー直下から少しだけ間を空ける（mt-5） -->
    <div class="mt-5 sm:mt-6">
      <%= render "shared/greeting", user: current_user %>
    </div>

    <% title_text, kind = fasting_hero(current_user) %>

    <!-- ステータスメッセージ：ヘッダー同色＋白文字／状態はドット -->
    <div class="flex justify-center">
      <div class="<%= hero_class_for(kind, theme: :neutral) %>"
           role="region" aria-label="ステータスメッセージ">
        <span class="sr-only">状態</span>
        <span class="w-2.5 h-2.5 rounded-full <%= status_dot_color(kind) %>"></span>
        <h1 class="text-base sm:text-lg font-extrabold tracking-wide leading-snug">
          <%= title_text %>
        </h1>
      </div>
    </div>

    <div class="text-gray-700">
      本日：<strong><%= l Time.zone.today, format: :long %></strong>
    </div>

    <% if @running&.target_hours.present? %>
      <div class="text-gray-700">
        目標時間：<strong><%= @running.target_hours %>時間</strong>
      </div>
    <% end %>

    <% if @running.present? %>
      <!-- 進行中カード -->
      <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
        <div class="flex items-center gap-3 text-lg sm:text-xl">
          <span class="text-2xl sm:text-3xl">🕒</span>
          <span
            data-controller="timer"
            data-timer-start-at-value="<%= @running.start_time.to_i %>"
            class="font-mono text-2xl sm:text-3xl align-middle">00:00:00</span>
        </div>
        <div class="text-sm text-gray-600">開始：<%= l @running.start_time %></div>
        <div class="text-right">
          <%= link_to "瞑想で心を整える",
                      meditations_path,
                      class: "text-sky-600 underline text-sm font-semibold" %>
        </div>
      </div>

      <!-- 終了ボタン：テキスト幅にフィット -->
      <div class="mt-6 sm:mt-8 mb-0 flex justify-center">
        <%= button_to "ファスティング終了",
              finish_fasting_record_path(@running),
              method: :post,
              form:  { class: "mx-auto" },
              class: "btn btn-danger btn-lg btn-wrap" %>
      </div>

    <% else %>
      <%= form_with url: start_fasting_records_path, method: :post, local: true,
                    html: { id: "start-form" }, class: "space-y-5 sm:space-y-6" do %>
        <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
          <label class="block text-sm text-gray-600">目標時間</label>
          <%= select_tag :target_hours,
                options_for_select(FastingRecord::TARGET_HOURS_CHOICES.map { |h| ["#{h}時間", h] }),
                include_blank: "選択してください🔽",
                required: true,
                class: "border rounded px-3 py-2 w-full max-w-xs" %>
        </div>

        <!-- 開始ボタン：テキスト幅にフィット -->
        <div class="pt-1 mb-1 sm:mb-0 flex justify-center">
          <%= submit_tag "ファスティング開始",
                class: "btn-mint btn-lg btn-wrap" %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
