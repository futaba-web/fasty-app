<%# app/views/mypages/show.html.erb %>
<div class="mypage-bg mypage-bg--compact">
  <!-- ä¸­èº«ã®ç¸¦ãƒªã‚ºãƒ ã‚’å¯å¤‰ã§çµ±ä¸€ -->
  <div class="mypage-stack max-w-3xl mx-auto px-6 pt-3 pb-4">

    <!-- æŒ¨æ‹¶ãƒãƒ¼ -->
    <div class="mt-3 sm:mt-4">
      <%= render "shared/greeting", user: current_user %>
    </div>

    <% title_text, kind = fasting_hero(current_user) %>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ -->
    <div class="flex justify-center">
      <div class="<%= hero_class_for(kind, theme: :neutral) %>" role="region" aria-label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
        <span class="w-2.5 h-2.5 rounded-full <%= status_dot_color(kind) %>"></span>
        <h1 class="text-base sm:text-lg font-extrabold tracking-wide leading-snug"><%= title_text %></h1>
      </div>
    </div>

    <div class="text-gray-700">
      æœ¬æ—¥ï¼š<strong><%= l Time.zone.today, format: :long %></strong>
    </div>

    <% if @running&.target_hours.present? %>
      <div class="text-gray-700">ç›®æ¨™æ™‚é–“ï¼š<strong><%= @running.target_hours %>æ™‚é–“</strong></div>
    <% end %>

    <% if @running.present? %>
      <!-- é€²è¡Œä¸­ã‚«ãƒ¼ãƒ‰ -->
      <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
        <div class="flex items-center gap-3 text-lg sm:text-xl">
          <span class="text-2xl sm:text-3xl">ðŸ•’</span>
          <span data-controller="timer"
                data-timer-start-at-value="<%= @running.start_time.to_i %>"
                class="font-mono text-2xl sm:text-3xl align-middle">00:00:00</span>
        </div>
        <div class="text-sm text-gray-600">é–‹å§‹ï¼š<%= l @running.start_time %></div>
        <div class="text-right">
          <%= link_to "çž‘æƒ³ã§å¿ƒã‚’æ•´ãˆã‚‹", meditations_path, class: "text-sky-600 underline text-sm font-semibold" %>
        </div>
      </div>

      <!-- çµ‚äº†ãƒœã‚¿ãƒ³ï¼šã‚„ã‚„ã‚¿ã‚¤ãƒˆã« -->
      <div class="mt-5 sm:mt-6 mb-2 flex justify-center">
        <%= button_to "ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°çµ‚äº†",
              finish_fasting_record_path(@running),
              method: :post,
              form:  { class: "mx-auto" },
              class: "btn btn-danger btn-lg btn-wrap" %>
      </div>

    <% else %>
      <%= form_with url: start_fasting_records_path, method: :post, local: true,
                    html: { id: "start-form" }, class: "space-y-5 sm:space-y-6" do %>
        <div class="rounded-lg border p-4 sm:p-5 space-y-3 bg-white/70">
          <label class="block text-sm text-gray-600">ç›®æ¨™æ™‚é–“</label>
          <%= select_tag :target_hours,
                options_for_select(FastingRecord::TARGET_HOURS_CHOICES.map { |h| ["#{h}æ™‚é–“", h] }),
                include_blank: "é¸æŠžã—ã¦ãã ã•ã„ðŸ”½",
                required: true,
                class: "border rounded px-3 py-2 w-full max-w-xs" %>
        </div>

        <div class="pt-1 mb-1 sm:mb-0 flex justify-center">
          <%= submit_tag "ãƒ•ã‚¡ã‚¹ãƒ†ã‚£ãƒ³ã‚°é–‹å§‹", class: "btn-mint btn-lg btn-wrap" %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
